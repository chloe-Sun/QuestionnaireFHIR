<html>
    <head>
        <link rel="stylesheet" href="./css/style.css"/>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
    </head>
    <body>
        <div class = "app">
            <div class = "header">
                    <h1>Kessler Psychological Distress Scale (K10)</h1>
                </div>
            <div class = "questionnaire">
                <h2><i>In the past 4 weeks, how often have you been bothered by any of the following problems?</i></h2>
                <div class = "question">
                    <p>Q1: Feeling tired out for no good reasons?</p>
                    <div class = "select_area">
                        <input type="radio" name = "select1" id="select1" value="LA6297-1">
                        <label for="cbox1">None of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select1" id="select1" value="LA14732-4">
                        <label for="cbox1">A little of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select1" id="select1" value="LA14733-2">
                        <label for="cbox1">Some of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select1" id="select1" value="LA14734-0">
                        <label for="cbox1">Most of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select1" id="select1" value="LA6154-4">
                        <label for="cbox1">All of the time</label>
                    </div>
                </div>

                <div class = "question">
                    <p>Q2: Feeling nervous?</p>
                    <div class = "select_area">
                        <input type="radio" name = "select2" id="select1" value="LA6297-1">
                        <label for="cbox1">None of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select2" id="select1" value="LA14732-4">
                        <label for="cbox1">A little of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select2" id="select1" value="LA14733-2">
                        <label for="cbox1">Some of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select2" id="select1" value="LA14734-0">
                        <label for="cbox1">Most of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select2" id="select1" value="LA6154-4">
                        <label for="cbox1">All of the time</label>
                    </div>
                </div>

                <div class = "question">
                    <p>Q3: Feeling so nervous that nothing could calm you down?</p>
                    <div class = "select_area">
                        <input type="radio" name = "select3" id="select1" value="LA6297-1">
                        <label for="cbox1">None of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select3" id="select1" value="LA14732-4">
                        <label for="cbox1">A little of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select3" id="select1" value="LA14733-2">
                        <label for="cbox1">Some of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select3" id="select1" value="LA14734-0">
                        <label for="cbox1">Most of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select3" id="select1" value="LA6154-4">
                        <label for="cbox1">All of the time</label>
                    </div>
                </div>

                <div class = "question">
                    <p>Q4: Feeling hopeless?</p>
                    <div class = "select_area">
                        <input type="radio" name = "select4" id="select1" value="LA6297-1">
                        <label for="cbox1">None of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select4" id="select1" value="LA14732-4">
                        <label for="cbox1">A little of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select4" id="select1" value="LA14733-2">
                        <label for="cbox1">Some of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select4" id="select1" value="LA14734-0">
                        <label for="cbox1">Most of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select4" id="select1" value="LA6154-4">
                        <label for="cbox1">All of the time</label>
                    </div>
                </div>

                <div class = "question">
                    <p>Q5: Feeling restless or fidgety?</p>
                    <div class = "select_area">
                        <input type="radio" name = "select5" id="select1" value="LA6297-1">
                        <label for="cbox1">None of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select5" id="select1" value="LA14732-4">
                        <label for="cbox1">A little of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select5" id="select1" value="LA14733-2">
                        <label for="cbox1">Some of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select5" id="select1" value="LA14734-0">
                        <label for="cbox1">Most of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select5" id="select1" value="LA6154-4">
                        <label for="cbox1">All of the time</label>
                    </div>
                </div>

                <div class = "question">
                    <p>Q6: Feeling so restless you could not sit still?</p>
                    <div class = "select_area">
                        <input type="radio" name = "select6" id="select1" value="LA6297-1">
                        <label for="cbox1">None of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select6" id="select1" value="LA14732-4">
                        <label for="cbox1">A little of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select6" id="select1" value="LA14733-2">
                        <label for="cbox1">Some of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select6" id="select1" value="LA14734-0">
                        <label for="cbox1">Most of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select6" id="select1" value="LA6154-4">
                        <label for="cbox1">All of the time</label>
                    </div>
                </div>

                <div class = "question">
                    <p>Q7: Feeling depressed?</p>
                    <div class = "select_area">
                        <input type="radio" name = "select7" id="select1" value="LA6297-1">
                        <label for="cbox1">None of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select7" id="select1" value="LA14732-4">
                        <label for="cbox1">A little of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select7" id="select1" value="LA14733-2">
                        <label for="cbox1">Some of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select7" id="select1" value="LA14734-0">
                        <label for="cbox1">Most of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select7" id="select1" value="LA6154-4">
                        <label for="cbox1">All of the time</label>
                    </div>
                </div>

                <div class = "question">
                    <p>Q8: Feeling everything was an effort</p>
                    <div class = "select_area">
                        <input type="radio" name = "select8" id="select1" value="LA6297-1">
                        <label for="cbox1">None of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select8" id="select1" value="LA14732-4">
                        <label for="cbox1">A little of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select8" id="select1" value="LA14733-2">
                        <label for="cbox1">Some of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select8" id="select1" value="LA14734-0">
                        <label for="cbox1">Most of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select8" id="select1" value="LA6154-4">
                        <label for="cbox1">All of the time</label>
                    </div>
                </div>

                <div class = "question">
                    <p>Q9: Feeling so sad that nothing could cheer you up?</p>
                    <div class = "select_area">
                        <input type="radio" name = "select9" id="select1" value="LA6297-1">
                        <label for="cbox1">None of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select9" id="select1" value="LA14732-4">
                        <label for="cbox1">A little of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select9" id="select1" value="LA14733-2">
                        <label for="cbox1">Some of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select9" id="select1" value="LA14734-0">
                        <label for="cbox1">Most of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select9" id="select1" value="LA6154-4">
                        <label for="cbox1">All of the time</label>
                    </div>
                </div>

                <div class = "question">
                    <p>Q10: Feeling worthless?</p>
                    <div class = "select_area">
                        <input type="radio" name = "select10" id="select1" value="LA6297-1">
                        <label for="cbox1">None of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select10" id="select1" value="LA14732-4">
                        <label for="cbox1">A little of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select10" id="select1" value="LA14733-2">
                        <label for="cbox1">Some of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select10" id="select1" value="LA14734-0">
                        <label for="cbox1">Most of the time</label>
                    </div>
                    <div class = "select_area">
                        <input type="radio" name = "select10" id="select1" value="LA6154-4">
                        <label for="cbox1">All of the time</label>
                    </div>
                </div>

                <button id="submit" style = "margin: 0.4em; width: 6em; height: 2.3em; background: #4D5656; border: none; border-radius: 5px;
                color: #fbfbfb;
                text-shadow: 1px 1px 1px rgba(0,0,0,.4);
                font-size: 0.9em;
                text-align: center;
                box-shadow: 0px 3px 0px 0px rgba(0,0,0,.2);
                cursor: pointer;">Submit</button>

            </div>
            <div class = "bottom">
              <a href = "index.html"><span>Home</span></a>
              <a href = "patient.html"><span>Questionnaire</span></a>
              <a href = "profile.html"><span>Profile</span></a>
              <a href = "about.html"><span>About</span></a>
          </div>
        </div>
    </body>
    <script>
        var answers = [];
        var codes = [];
        const client = JSON.parse(localStorage.getItem("client"));
        console.log(client);  
        document.getElementById("submit").addEventListener("click", function() {
            for (i = 0; i < 10; i++) {
                const name = "select" + (i+1);
                var choices = document.getElementsByName(name);
                console.log(choices);
                for (j = 0; j < 5; j++) {
                    if (choices[j].checked) {
                    codes.push(choices[j].value);
                    }
                }
            }
            for (i = 0; i < 10; i++) {
                const code = codes[i];
                if (code == "LA6297-1") {
                    answers.push("None of the time");
                } else if (code == "LA14732-4") {
                    answers.push("A little of the time");
                } else if (code == "LA14733-2") {
                    answers.push("Some of the time");
                } else if (code == "LA14734-0") {
                    answers.push("Most of the time");
                } else {
                    answers.push("All of the time");
                }
            }
            const date = new Date();
            var month = date.getMonth() + 1;
            month = month < 10 ? '0' + month : '' + month;
            const k_10 = {
                "resourceType" : "QuestionnaireResponse",
                "id" : "questionnaireresponse-phq9-" + client.patient.id,
                // "meta" : {
                //     "profile" : [
                //     "http://fhir.org/guides/argonaut/questionnaire/StructureDefinition/argo-questionnaireresponse"
                //     ]
                // },
                "text" : {
                    "status" : "generated",
                    "div" : "<div xmlns=\"http://www.w3.org/1999/xhtml\"><div class=\"hapiHeaderText\">Fran <b>AJUSTED </b></div><table class=\"hapiPropertyTable\"><tbody/></table></div>"
                },
                // "extension" : [
                //     {
                //     "url" : "http://fhir.org/guides/argonaut/questionnaire/StructureDefinition/extension-responsePeriod",
                //     "valuePeriod" : {
                //         "start" : "2019-02-13T00:36:07.985403Z",
                //         "end" : "2019-02-13T00:36:41.051113Z"
                //     }
                //     }
                // ],
                "identifier" : {
                    "value" : "k-10 response"
                },
                "questionnaire" : {
                    "reference" : "https://connect4.uqcloud.net/resources/K10_kessler_psychological_distress_scale.json"
                },
                "status" : "completed",
                "subject" : {
                    "reference" : "Patient/" + client.patient.id
                },
                "context" : {
                    "reference" : "Encounter/encounter1"
                },
                "authored" : date.getFullYear() + "-" + month + "-" + date.getDate(),
                "author" : {
                    "reference" : "Practitioner/" + client.user.id
                },
                "source" : {
                    "reference" : "Patient/" + client.patient.id
                },
                "item": [ {
                    "linkId": "1",
                    "text": "During the last 30 days, about how often did you feel tired out for no good reason?",
                    "answer": [ {
                    "valueCoding": {
                        "system": "http://loinc.org",
                        "code" : codes[0],
                        "display" : answers[0]
                    }
                    } ]
                }, {
                    "linkId": "2",
                    "text": "During the last 30 days, about how often did you feel nervous?",
                    "answer": [ {
                    "valueCoding": {
                        "system": "http://loinc.org",
                        "code" : codes[1],
                        "display" : answers[1]
                    }
                    } ]
                }, {
                    "linkId": "3",
                    "text": "During the last 30 days, about how often did you feel so nervous that nothing could calm you down?",
                    "answer": [ {
                    "valueCoding": {
                        "system": "http://loinc.org",
                        "code" : codes[2],
                        "display" : answers[2]
                    }
                    } ]
                }, {
                    "linkId": "4",
                    "text": "During the last 30 days, about how often did you feel hopeless?",
                    "answer": [ {
                    "valueCoding": {
                        "system": "http://loinc.org",
                        "code" : codes[3],
                        "display" : answers[3]
                    }
                    } ]
                }, {
                    "linkId": "5",
                    "text": "During the last 30 days, about how often did you feel restless or fidgety?",
                    "answer": [ {
                    "valueCoding": {
                        "system": "http://loinc.org",
                        "code" : codes[4],
                        "display" : answers[4]
                    }
                    } ]
                }, {
                    "linkId": "6",
                    "text": "During the last 30 days, about how often did you feel so restless you could not sit still?",
                    "answer": [ {
                    "valueCoding": {
                        "system": "http://loinc.org",
                        "code" : codes[5],
                        "display" : answers[5]
                    }
                    } ]
                }, {
                    "linkId": "7",
                    "text": "During the last 30 days, about how often did you feel depressed?",
                    "answer": [ {
                    "valueCoding": {
                        "system": "http://loinc.org",
                        "code" : codes[6],
                        "display" : answers[6]
                    }
                    } ]
                }, {
                    "linkId": "8",
                    "text": "During the last 30 days, about how often did you feel that everything was an effort?",
                    "answer": [ {
                    "valueCoding": {
                        "system": "http://loinc.org",
                        "code" : codes[7],
                        "display" : answers[7]
                    }
                    } ]
                }, {
                    "linkId": "9",
                    "text": "During the last 30 days, about how often did you feel so sad that nothing could cheer you up?",
                    "answer": [ {
                    "valueCoding": {
                        "system": "http://loinc.org",
                        "code" : codes[8],
                        "display" : answers[8]
                    }
                    } ]
                }, {
                    "linkId": "10",
                    "text": "During the last 30 days, about how often did you feel worthless?",
                    "answer": [ {
                    "valueCoding": {
                        "system": "http://loinc.org",
                        "code" : codes[9],
                        "display" : answers[9]
                    }
                    } ]
                }], 
                "search": {
                "mode": "include"
                }
            }
            localStorage.setItem("k-10",JSON.stringify(k_10));
            alert("submitted successfully");
            location.href = "index.html";
            
        })
    </script>
</html>