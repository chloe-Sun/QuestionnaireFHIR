<html lang="en">
<head>
    <link rel="stylesheet" href="css/style.css"/>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Main page</title>
</head>
<body>
    <div class = "app">
        <div class = "header">
            <h1>Smartphone Questionnaire App</h1>
        </div>
        <div class = "content">
            <figure class = "menu">
                <a href = "profile.html">
                    <img src = "./images/user.png">
                    <figcaption>User Profile</figcaption>
                </a>
            </figure>

            <figure class = "menu">
                <a href = "patient.html">
                    <img src = "./images/patientList.jpg">
                    <figcaption>Patient List</figcaption>
                </a>
            </figure>

            <figure class = "menu">
                <a href = "about.html">
                    <img src = "./images/about.jpg">
                    <figcaption>About</figcaption>
                </a>
            </figure>
        </div>
        
        <p class = "copyright">Copyright @ COMP3001-G6</p>
    </div>
</body>
    <script src="https://cdn.jsdelivr.net/npm/fhirclient/build/fhir-client.js"></script>
    <script>
        FHIR.oauth2.ready().then(function(client) {

        client.patient.read().then(
            function(pt) {
                localStorage.setItem("patientInfo",JSON.stringify(pt, null, 4));
                console.log(pt);
            },
            function(error) {
                document.getElementById("patient").innerText = error.stack;
            }
        );

        client.user.read().then(
            function(ur) {
                localStorage.setItem("userInfo",JSON.stringify(ur,null,4));
                console.log(ur);
            },
            function(error) {
                console.log("get user info failed");
            }
        )


        client.request("/QuestionnaireResponse?patient=" + client.patient.id, {
            resolveReferences: [ "QuestionnaireResponseReference" ],
            graph: true
        })
        

        .then(function(data) {
            localStorage.setItem("questionnaire", JSON.stringify(data.text.div));
            console.log(data)
            if (!data.entry || !data.entry.length) {
                localStorage.setItem("questionnaire", "No questionnaire found for the selected patient");
                // throw new Error("No questionnaire found for the selected patient");
            }
            return data.entry;
        })
        

        .then(
            function(meds) {
                document.getElementById("ques").innerText = JSON.stringify(meds, null, 4);
                
            },
            function(error) {
                document.getElementById("ques").innerText = error.stack;
            }
        );

        const k10 = {
            "resourceType": "Questionnaire",
            "id": "k-10-questionnaire",
            "text": {
                "status": "generated",
                "div": "<div xmlns=\"http://www.w3.org/1999/xhtml\">PHQ-9 Questionnaire with dynamic logic</div>"
            },
            "title": "Kessler Psychological Distress Scale (K10)",
            "status": "active",
            "subjectType": [
                "Patient"
            ],
            "item": [
                {
                "linkId": "1",
                "text": "1. During the last 30 days, about how often did you feel tired out for no good reason?",
                "type": "choice",
                "required": true,
                "type": "choice",
                },
                {
                "linkId": "2",
                "text": "2. During the last 30 days, about how often did you feel nervous?",
                "type": "choice",
                "required": true,
                "type": "string"
                },
                {
                "linkId": "3",
                "text": "3. During the last 30 days, about how often did you feel so nervous that nothing could calm you down?",
                "type": "choice",
                "required": true,
                "type": "string"
                },
                {
                "linkId": "4",
                "text": "4. During the last 30 days, about how often did you feel hopeless?",
                "type": "choice",
                "required": true,
                "type": "string"
                },
                {
                "linkId": "5",
                "text": "5. During the last 30 days, about how often did you feel restless or fidgety?",
                "type": "choice",
                "required": true,
                "type": "string"
                },
                {
                "linkId": "6",
                "text": "6. During the last 30 days, about how often did you feel so restless you could not sit still?",
                "type": "choice",
                "required": true,
                "type": "string"
                },
                {
                "linkId": "7",
                "text": "7. During the last 30 days, about how often did you feel depressed?",
                "type": "choice",
                "required": true,
                "type": "string"
                },
                {
                    "linkId": "7",
                "text": "7. During the last 30 days, about how often did you feel depressed?",
                "type": "choice",
                "required": true,
                "type": "string"
                },
                {
                    "linkId": "8",
                "text": "8. During the last 30 days, about how often did you feel that everything was an effort?",
                "type": "choice",
                "required": true,
                "type": "string"
                },
                {
                "linkId": "9",
                "text": "9. During the last 30 days, about how often did you feel so sad that nothing could cheer you up?",
                "type": "choice",
                "required": true,
                "type": "string"
                },
                {
                "linkId": "10",
                "text": "10. During the last 30 days, about how often did you feel worthless?",
                "type": "choice",
                "required": true,
                "type": "string"
                }

            ]
            }

        }).catch(console.error);

        
    </script>
</html>
