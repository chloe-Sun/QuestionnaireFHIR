<html lang="en">
<head>
    <link rel="stylesheet" href="css/style.css"/>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Main page</title>
</head>
<body>
    <div class = "app">
        <div class = "header">
            <h1>Smartphone Questionnaire App</h1>
        </div>
        <div class = "content">
            <figure class = "menu">
                <a href = "profile.html">
                    <img src = "./images/user.png">
                    <figcaption>User Profile</figcaption>
                </a>
            </figure>

            <figure class = "menu">
                <a href = "patient.html">
                    <img src = "./images/patientList.jpg">
                    <figcaption>Patient List</figcaption>
                </a>
            </figure>

            <figure class = "menu">
                <a href = "about.html">
                    <img src = "./images/about.jpg">
                    <figcaption>About</figcaption>
                </a>
            </figure>
        </div>
        
        <p class = "copyright">Copyright @ COMP3001-G6</p>
    </div>
</body>
    <script src="https://cdn.jsdelivr.net/npm/fhirclient/build/fhir-client.js"></script>
    <script>
        FHIR.oauth2.ready().then(function(client) {

        client.patient.read().then(
            function(pt) {
                localStorage.setItem("patientInfo",JSON.stringify(pt, null, 4));
                console.log(pt);
            },
            function(error) {
                document.getElementById("patient").innerText = error.stack;
            }
        );

        client.user.read().then(
            function(ur) {
                localStorage.setItem("userInfo",JSON.stringify(ur,null,4));
                console.log(ur);
            },
            function(error) {
                console.log("get user info failed");
            }
        )


        client.request("/QuestionnaireResponse?patient=" + client.patient.id, {
            resolveReferences: [ "QuestionnaireResponseReference" ],
            graph: true
        })
        

        .then(function(data) {
            localStorage.setItem("questionnaire", JSON.stringify(data.entry));
            console.log(localStorage.getItem("questionnaire"))
            if (!data.entry || !data.entry.length) {
                localStorage.setItem("questionnaire", "No questionnaire found for the selected patient");
                // throw new Error("No questionnaire found for the selected patient");
            }
            return data.entry;
            
        });

        // const phq_9 = {
        //   "resourceType" : "QuestionnaireResponse",
        //   "id" : "questionnaireresponse-example-phq9",
        //   "meta" : {
        //     "profile" : [
        //       "http://fhir.org/guides/argonaut/questionnaire/StructureDefinition/argo-questionnaireresponse"
        //     ]
        //   },
        //   "text" : {
        //     "status" : "generated",
        //     "div" : "<div xmlns=\"http://www.w3.org/1999/xhtml\">\n    <h3>Response Summary</h3>\n    <strong>Questionnaire URL:</strong> http://fhir.org/guides/argonaut/questionnaire/Questionnaire/questionnaire-example-phq9<br />\n    <strong>Date Completed:</strong> 2019-02-13T00:36:41.051113Z<br />\n    <hr /> <br /><strong>Over the last 2 weeks, how often have you been bothered by any of the following problems? (Use “X” to indicate your answer)</strong><br /><br /> <strong>Question:</strong> (linkID=g1.q1) Little interest or pleasure in doing things,<br /><strong>Response:</strong>  Not at all ( code = LA6568-5, codesystem = http://loinc.org)<br /><br /> <strong>Question:</strong> (linkID=g1.q2) Feeling down, depressed, or hopeless,<br /><strong>Response:</strong>  Not at all ( code = LA6568-5, codesystem = http://loinc.org)<br /><br /> <strong>Question:</strong> (linkID=g1.q3) Trouble falling or staying asleep, or sleeping too much<br /><strong>Response:</strong>  Not at all ( code = LA6568-5, codesystem = http://loinc.org)<br /><br /> <strong>Question:</strong> (linkID=g1.q4) Feeling tired or having little energy,<br /><strong>Response:</strong>  Not at all ( code = LA6568-5, codesystem = http://loinc.org)<br /><br /> <strong>Question:</strong> (linkID=g1.q5) Poor appetite or overeating,<br /><strong>Response:</strong>  Not at all ( code = LA6568-5, codesystem = http://loinc.org)<br /><br /> <strong>Question:</strong> (linkID=g1.q6) Feeling bad about yourself - or that you are a failure or have let yourself or your family down,<br /><strong>Response:</strong>  Not at all ( code = LA6568-5, codesystem = http://loinc.org)<br /><br /> <strong>Question:</strong> (linkID=g1.q7) Trouble concentrating on things, such as reading the newspaper or watching television,<br /><strong>Response:</strong>  Not at all ( code = LA6568-5, codesystem = http://loinc.org)<br /><br /> <strong>Question:</strong> (linkID=g1.q8) Moving or speaking so slowly that other people could have noticed. Or the opposite - being so fidgety or restless that you have been moving around a lot more than usual,<br /><strong>Response:</strong>  Not at all ( code = LA6568-5, codesystem = http://loinc.org)<br /><br /> <strong>Question:</strong> (linkID=g1.q9) Thoughts that you would be better off dead, or of hurting yourself<br /><strong>Response:</strong>  Not at all ( code = LA6568-5, codesystem = http://loinc.org)<br /><br /><strong>Scoring: \nAdd up all checked boxes on PHQ-9. \n\nFor every:\nNot at all = 0;\nSeveral days = 1;\nMore than half the days = 2;\nNearly every day = 3\n\nInterpretation of Total Score\nTotal Score Depression Severity\n1-4 Minimal depression\n5-9 Mild depression\n10-14 Moderate depression\n15-19 Moderately severe depression\n20-27 Severe depression (this is hidden text/should not be displayed to the user)</strong><br /><br /> <strong>Question:</strong> (linkID=g2.q1) If you checked off any problems, how difficult have these problems made it for you to do your work, take care of things at home, or get along with other people,<br /><strong>Response:</strong>  Not difficult at all ( code = LA6572-7, codesystem = http://loinc.org)<br /> <br /><br />\n    </div>"
        //   },
        //   "extension" : [
        //     {
        //       "url" : "http://fhir.org/guides/argonaut/questionnaire/StructureDefinition/extension-responsePeriod",
        //       "valuePeriod" : {
        //         "start" : "2019-02-13T00:36:07.985403Z",
        //         "end" : "2019-02-13T00:36:41.051113Z"
        //       }
        //     }
        //   ],
        //   "identifier" : {
        //     "value" : "questionnaireresponse-example-phq9"
        //   },
        //   "questionnaire" : {
        //     "reference" : "http://fhir.org/guides/argonaut/questionnaire/Questionnaire/questionnaire-example-phq9"
        //   },
        //   "status" : "completed",
        //   "subject" : {
        //     "reference" : "Patient/" + client.patient.id
        //   },
        //   "context" : {
        //     "reference" : "Encounter/encounter1"
        //   },
        //   "authored" : "2019-02-13T00:36:41.051113Z",
        //   "author" : {
        //     "reference" : "Practitioner/" + client.user.id
        //   },
        //   "source" : {
        //     "reference" : "Patient/" + client.patient.id
        //   },
        //   "item" : [
        //     {
        //       "linkId" : "g1",
        //       "item" : [
        //         {
        //           "linkId" : "g1.d",
        //           "text" : "Over the last 2 weeks, how often have you been bothered by any of the following problems? (Use “X” to indicate your answer)"
        //         },
        //         {
        //           "linkId" : "g1.q1",
        //           "text" : "Little interest or pleasure in doing things,",
        //           "answer" : [
        //             {
        //               "valueCoding" : {
        //                 "system" : "http://loinc.org",
        //                 "code" : "LA6568-5",
        //                 "display" : "Not at all"
        //               }
        //             }
        //           ]
        //         },
        //         {
        //           "linkId" : "g1.q2",
        //           "text" : "Feeling down, depressed, or hopeless,",
        //           "answer" : [
        //             {
        //               "valueCoding" : {
        //                 "system" : "http://loinc.org",
        //                 "code" : "LA6568-5",
        //                 "display" : "Not at all"
        //               }
        //             }
        //           ]
        //         },
        //         {
        //           "linkId" : "g1.q3",
        //           "text" : "Trouble falling or staying asleep, or sleeping too much",
        //           "answer" : [
        //             {
        //               "valueCoding" : {
        //                 "system" : "http://loinc.org",
        //                 "code" : "LA6568-5",
        //                 "display" : "Not at all"
        //               }
        //             }
        //           ]
        //         },
        //         {
        //           "linkId" : "g1.q4",
        //           "text" : "Feeling tired or having little energy,",
        //           "answer" : [
        //             {
        //               "valueCoding" : {
        //                 "system" : "http://loinc.org",
        //                 "code" : "LA6568-5",
        //                 "display" : "Not at all"
        //               }
        //             }
        //           ]
        //         },
        //         {
        //           "linkId" : "g1.q5",
        //           "text" : "Poor appetite or overeating,",
        //           "answer" : [
        //             {
        //               "valueCoding" : {
        //                 "system" : "http://loinc.org",
        //                 "code" : "LA6568-5",
        //                 "display" : "Not at all"
        //               }
        //             }
        //           ]
        //         },
        //         {
        //           "linkId" : "g1.q6",
        //           "text" : "Feeling bad about yourself - or that you are a failure or have let yourself or your family down,",
        //           "answer" : [
        //             {
        //               "valueCoding" : {
        //                 "system" : "http://loinc.org",
        //                 "code" : "LA6568-5",
        //                 "display" : "Not at all"
        //               }
        //             }
        //           ]
        //         },
        //         {
        //           "linkId" : "g1.q7",
        //           "text" : "Trouble concentrating on things, such as reading the newspaper or watching television,",
        //           "answer" : [
        //             {
        //               "valueCoding" : {
        //                 "system" : "http://loinc.org",
        //                 "code" : "LA6568-5",
        //                 "display" : "Not at all"
        //               }
        //             }
        //           ]
        //         },
        //         {
        //           "linkId" : "g1.q8",
        //           "text" : "Moving or speaking so slowly that other people could have noticed. Or the opposite - being so fidgety or restless that you have been moving around a lot more than usual,",
        //           "answer" : [
        //             {
        //               "valueCoding" : {
        //                 "system" : "http://loinc.org",
        //                 "code" : "LA6568-5",
        //                 "display" : "Not at all"
        //               }
        //             }
        //           ]
        //         },
        //         {
        //           "linkId" : "g1.q9",
        //           "text" : "Thoughts that you would be better off dead, or of hurting yourself",
        //           "answer" : [
        //             {
        //               "valueCoding" : {
        //                 "system" : "http://loinc.org",
        //                 "code" : "LA6568-5",
        //                 "display" : "Not at all"
        //               }
        //             }
        //           ]
        //         },
        //         {
        //           "linkId" : "g1.s",
        //           "text" : "Scoring: \nAdd up all checked boxes on PHQ-9. \n\nFor every:\nNot at all = 0;\nSeveral days = 1;\nMore than half the days = 2;\nNearly every day = 3\n\nInterpretation of Total Score\nTotal Score Depression Severity\n1-4 Minimal depression\n5-9 Mild depression\n10-14 Moderate depression\n15-19 Moderately severe depression\n20-27 Severe depression"
        //         }
        //       ]
        //     },
        //     {
        //       "linkId" : "g2",
        //       "item" : [
        //         {
        //           "linkId" : "g2.q1",
        //           "text" : "If you checked off any problems, how difficult have these problems made it for you to do your work, take care of things at home, or get along with other people,",
        //           "answer" : [
        //             {
        //               "valueCoding" : {
        //                 "system" : "http://loinc.org",
        //                 "code" : "LA6572-7",
        //                 "display" : "Not difficult at all"
        //               }
        //             }
        //           ]
        //         }
        //       ]
        //     }
        //   ]
        // }

        // client.create(phq_9);

        }).catch(console.error);

        
    </script>
</html>
